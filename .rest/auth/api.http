@baseUrl = http://localhost:4000/api/v1
@accessToken =
@refreshToken =

###
### 1) Register demo user (one-off, POST is canonical)
# @name registerDemo
POST {{baseUrl}}/account/register
Content-Type: application/json

{
  "email": "demo@example.com",
  "username": "demo",
  "password": "changeme",
  "tos_accepted": true
}

###
### 2) Login with demo user (sets tokens) [POST only]
# @name authTokens
POST {{baseUrl}}/account/auth/login
Content-Type: application/json

{
  "identifier": "demo",
  "password": "changeme",
  "fingerprint": "rest-client",
  "device_name": "REST Client"
}

###
# Token variables — taken from LAST response of any request named "authTokens"
@accessToken = {{authTokens.response.body.$.data.tokens.access.token}}
@refreshToken = {{authTokens.response.body.$.data.tokens.refresh.token}}

###
### 3) Fetch profile (me)
POST {{baseUrl}}/account/me
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{}

###
### 4) Refresh tokens (POST)
# @name authTokens
POST {{baseUrl}}/account/auth/refresh
Content-Type: application/json

{
  "refresh_token": "{{refreshToken}}"
}

###
### 5) Change password (POST)
POST {{baseUrl}}/account/auth/password
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "current_password": "changeme",
  "new_password": "super-secret-123",
  "logout_all": true
}

###
### 6) Login with new password (updates authTokens) [POST only]
# @name authTokens
POST {{baseUrl}}/account/auth/login
Content-Type: application/json

{
  "identifier": "demo",
  "password": "super-secret-123"
}

###
### 7) Logout current session (POST)
POST {{baseUrl}}/account/auth/logout
Content-Type: application/json

{
  "refresh_token": "{{refreshToken}}"
}

###
### 8) Logout all devices for current user (POST)
POST {{baseUrl}}/account/auth/logout/all-devices
Authorization: Bearer {{accessToken}}

###
### 9) Logout all users (admin / maintenance) (POST)
POST {{baseUrl}}/account/auth/logout/all-users
Authorization: Bearer {{accessToken}}

###
### 10) Vendor info (GET)
POST {{baseUrl}}/account/auth/vendor/discord
Content-Type: application/json

{}

###
### 11) Vendor login (POST)
# @name vendorTokens
POST {{baseUrl}}/account/auth/vendor/discord/login
Content-Type: application/json

{
  "code": "sandbox-code",
  "token": "sandbox-code",
  "email": "demo+discord@example.com"
}
